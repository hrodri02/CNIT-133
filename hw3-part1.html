<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Javascript HW 3 part 1">
        <title>CNIT 133 HW2</title>
        <link rel="stylesheet" href="style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script>
            $(document).ready(function() {
                // update the selected page in the nav bar
                const currentPath = window.location.pathname;
                const parts = currentPath.split('/');
                const currentPage = parts[parts.length - 1];
                // Iterate over each <a> tag 
                $("nav").children('a').each(function () {
                    // Check if the href attribute matches the current path
                    if ($(this).attr('href') === currentPage) {
                        $(this).addClass('nav-active'); // Add the 'active' class
                    }
                });

                $("#calculateFinalGrade").click(function() {
                    const hwAvg = parseInt(document.forms["myform"].elements["hwAvg"].value);
                    const midterm = parseInt(document.forms["myform"].elements["midterm"].value);
                    const finalExam = parseInt(document.forms["myform"].elements["finalExam"].value);
                    const participation = parseInt(document.forms["myform"].elements["participation"].value);
                    
                    const err_msg = validateInputs(hwAvg, midterm, finalExam, participation);
                    
                    const textarea = document.forms["myform"].elements["result"];
                    if (err_msg) {
                        displayErrorMessage(textarea, err_msg);
                    }
                    else {
                        const finalGrade = calculateFinalGrade(hwAvg, midterm, finalExam, participation);
                        const letterGrade = getLetterGrade(finalGrade);
                        displayResults(textarea, finalGrade, letterGrade);
                    }
                });
            });

            function validateInputs(hwAvg, midterm, finalExam, participation) {
                if (!isIntegerBetweenZeroAndOneHundred(hwAvg))
                    return "Error: homework average must be an integer between 0 and 100.";

                if (!isIntegerBetweenZeroAndOneHundred(midterm))
                    return "Error: midterm grade must be an integer between 0 and 100.";

                if (!isIntegerBetweenZeroAndOneHundred(finalExam))
                    return "Error: final exam grade must be an integer between 0 and 100.";

                if (!isIntegerBetweenZeroAndOneHundred(participation))
                    return "Error: participation grade must be an integer between 0 and 100.";

                return null;
            }

            function isIntegerBetweenZeroAndOneHundred(num) {
                return !Number.isNaN(num) && num >= 0 && num <= 100;
            }

            function displayErrorMessage(textarea, err_msg) {
                textarea.value = err_msg;
            }

            function displayResults(textarea, finalGrade, letterGrade) {
                textarea.value = `Final Average: ${finalGrade}\nFinal Letter Grade: ${letterGrade}`;
                if (didFailClass(letterGrade))
                    textarea.value += "\nStudent must retake the course.";
            }

            function calculateFinalGrade(hwAvg, midterm, finalExam, participation) {
                return Math.round((.5 * hwAvg) + (.2 * midterm) + (.2 * finalExam) + (.1 * participation));
            }

            function getLetterGrade(grade) {
                switch (true) {
                    case grade < 60:
                        return 'F';
                    case grade < 70:
                        return 'D';
                    case grade < 80:
                        return 'C';
                    case grade < 90:
                        return 'B';
                    default:
                        return 'A';
                }
            }

            function didFailClass(letterGrade) {
                return letterGrade === "D" || letterGrade === "F";
            }
        </script>
    </head>
    <body>
        <header>
            <h2>CNIT 133 Homework 3 - Functions</h2>
        </header>
        <nav>
            <a href="hw1.html">HW list</a>
            <a href="hw3.html">Home</a>
            <a href="hw3-part1.html">Part 1</a>
            <a href="hw3-part2.html">Part 2</a>
            <a href="hw3-part3.html">Part 3</a>
        </nav>
        <section id="hw3-section">
            <h3>Calculate a Student's Grade</h3>
            <form name="myform">
                <table>
                    <tr>
                        <td><label for='hwAvg'>Homework Average</label></td>
                        <td><input type="number" name="hwAvg" id="hwAvg" value="0" style='text-align:right;'></td>
                    </tr>
                    <tr>
                        <td><label for='midterm'>Midterm Grade</label></td>
                        <td><input type="number" name="midterm" id="midterm" value="0" style='text-align:right;' title="We ask for your Grade Point Average only for statistical purposes."></td>
                    </tr>
                    <tr>
                        <td><label for='finalExam'>Final Exam Grade</label></td>
                        <td><input type="number" name="finalExam" id="finalExam" value="0" style='text-align:right;'></td>
                    </tr>
                    <tr>
                        <td><label for='participation'>Participation Grade</label></td>
                        <td><input type="number" name="participation" id="participation" value="0" style='text-align:right;'></td>
                    </tr>
                </table>
                <br><label>Results</label><br>
                <textarea rows="3" cols="40" name="result" id="result"></textarea>
                <br><br>
                <input type="button" id="calculateFinalGrade" value="SUBMIT">
                <input type="reset" value="RESET">
            </form>
        </section>
        <script>
        </script>
    </body>
</html>